name: CI Tests

on:
  push:
    branches: [ main, beta, alpha ]
  pull_request:
    branches: [ main, beta, alpha ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  test:
    name: Run Core Tests
    runs-on: ubuntu-latest

    steps:
      - name: Checkout wp-examples
        uses: actions/checkout@v4

      - name: Install wparse tools
        run: |
          if [ "${{ github.ref_name }}" = "main" ]; then
            curl -sSf https://get.warpparse.ai/setup.sh | bash
          elif [ "${{ github.ref_name }}" = "beta" ]; then
            curl -sSf https://get.warpparse.ai/beta_setup.sh | bash
          elif [ "${{ github.ref_name }}" = "alpha" ]; then
            curl -sSf https://get.warpparse.ai/alpha_setup.sh | bash
          else
            curl -sSf https://get.warpparse.ai/setup.sh | bash
          fi

      - name: Verify tools
        run: |
          wparse --version || true
          wpgen --version || true
          wproj --version || true

      - name: Run all core tests
        run: |
          cd core
          bash run_all.sh

  test-macos:
    name: Run Core Tests (macOS)
    runs-on: macos-latest

    steps:
      - name: Checkout wp-examples
        uses: actions/checkout@v4

      - name: Install wparse tools
        run: |
          if [ "${{ github.ref_name }}" = "main" ]; then
            curl -sSf https://get.warpparse.ai/setup.sh | bash
          elif [ "${{ github.ref_name }}" = "beta" ]; then
            curl -sSf https://get.warpparse.ai/beta_setup.sh | bash
          elif [ "${{ github.ref_name }}" = "alpha" ]; then
            curl -sSf https://get.warpparse.ai/alpha_setup.sh | bash
          else
            curl -sSf https://get.warpparse.ai/setup.sh | bash
          fi

      - name: Verify tools
        run: |
          wparse --version || true
          wpgen --version || true
          wproj --version || true

      - name: Run all core tests
        run: |
          cd core
          bash run_all.sh
