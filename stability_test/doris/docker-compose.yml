services:

  # Doris-1 集群
  doris-1-fe:
    image: apache/doris:fe-2.1.9
    hostname: doris-1-fe
    ports:
      - "8030:8030"  # 宿主机8030映射到容器8030
      - "9030:9030"
      - "9010:9010"
    environment:
      - FE_SERVERS=fe1:172.30.80.2:9010
      - FE_ID=1
    networks:
      custom_network_1:
        ipv4_address: 172.30.80.2

  doris-1-be:
    image: apache/doris:be-2.1.9
    hostname: doris-1-be
    ports:
      - "8040:8040"
      - "9050:9050"
    environment:
      - FE_SERVERS=fe1:172.30.80.2:9010
      - BE_ADDR=172.30.80.3:9050
    depends_on:
      - doris-1-fe
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://127.0.0.1:8040/api/health"]
      interval: 15s
      timeout: 10s
      retries: 10
      start_period: 20s
    networks:
      custom_network_1:
        ipv4_address: 172.30.80.3

networks:
  custom_network_1:
    driver: bridge
    ipam:
      config:
        - subnet: 172.30.80.0/24