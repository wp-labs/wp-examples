version = "2.0"

[sink_group]
name = "nginx"
rule = ["/nginx/nginx","version:1"]

# file
[[sink_group.sinks]]
connect = "file_json_sink"
name = "file-1-nginx"
params = { file = "file-1.dat" }
tags = ["log_type:nginx","version:1"]

# Kafka
[[sink_group.sinks]]
connect = "kafka_sink"
name = "kafka-1-nginx"
params= { topic = "wp.output.nginx" ,brokers = "localhost:9092" }
tags = ["log_type:nginx","version:1"]

# vlog
[[sink_group.sinks]]
name = "vlog-1-nginx"
connect = "victorialogs_sink"
params = { endpoint = "http://localhost:9428", insert_path = "/insert/jsonline", flush_interval_secs = 3}
tags = ["log_type:nginx","version:1"]

# doris
[[sink_group.sinks]]
name = "doris-1-nginx"
connect = "doris_sink"
tags = ["log_type:nginx","version:1"]
[sink_group.sinks.params]
endpoint="mysql://localhost:9030/?charset=utf8mb4&connect_timeout=10"
user = "root"
password = ""
database="test_db"
table = "wp_nginx"

# mysql
[[sink_group.sinks]]
name = "mysql-1-nginx"
connect = "mysql_sink"
tags = ["log_type:nginx","version:1"]
[sink_group.sinks.params]
endpoint = "localhost:3306"
username = "root"
password = "123456"
database = "test_db"
table = "wp_nginx"
columns = ["wp_event_id","wp_src_key","sip", "timestamp", "http/request", "status", "size", "referer", "http/agent"]

[sink_group.sinks.expect]
ratio = 0.50
tol   = 0.02
tags = ["log_type:nginx","version:1"]

# # ===========2===============
# Kafka
[[sink_group.sinks]]
connect = "kafka_sink"
name = "kafka-2-nginx"
params= { topic = "wp.output.nginx" ,brokers = "127.0.0.1:9093" }
tags = ["log_type:nginx","version:1"]

# file
[[sink_group.sinks]]
connect = "file_json_sink"
name = "file-2-nginx"
params = { file = "file-2.dat" }
tags = ["log_type:nginx","version:1"]

# vlog
[[sink_group.sinks]]
name = "vlog-2-nginx"
connect = "victorialogs_sink"
params = { endpoint = "http://localhost:9429", insert_path = "/insert/jsonline", flush_interval_secs = 3}
tags = ["log_type:nginx","version:1"]

# doris
[[sink_group.sinks]]
name = "doris-2-nginx"
connect = "doris_sink"
tags = ["log_type:nginx","version:1"]
[sink_group.sinks.params]
endpoint="mysql://localhost:9031/?charset=utf8mb4&connect_timeout=10"
user = "root"
password = ""
database="test_db"
table = "wp_nginx"

# mysql
[[sink_group.sinks]]
name = "mysql-2-nginx"
connect = "mysql_sink"
tags = ["log_type:nginx","version:1"]
[sink_group.sinks.params]
endpoint = "localhost:3307"
username = "root"
password = "123456"
database = "test_db"
table = "wp_nginx"
columns = ["wp_event_id","wp_src_key","sip", "timestamp", "http/request", "status", "size", "referer", "http/agent"]
